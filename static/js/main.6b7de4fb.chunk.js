(this.webpackJsonppwatest=this.webpackJsonppwatest||[]).push([[0],[,,,,,function(e,n,t){e.exports=t(14)},,,,,function(e,n,t){},function(e,n,t){e.exports=t.p+"static/media/logo.5d5d9eef.svg"},function(e,n,t){},,function(e,n,t){"use strict";t.r(n);var o=t(0),i=t.n(o),r=t(4),c=t.n(r),a=(t(10),t(11),t(12),t(1)),s=t.n(a),u=t(2),l="https://push-notification-demo-server.herokuapp.com";var f={post:function(e,n){return fetch("".concat(l).concat(e),{credentials:"omit",headers:{"content-type":"application/json;charset=UTF-8","sec-fetch-mode":"cors"},body:JSON.stringify(n),method:"POST",mode:"cors"}).then((function(e){return e.json()})).then((function(e){return e}))},get:function(e){return fetch("".concat(l).concat(e),{credentials:"omit",headers:{"content-type":"application/json;charset=UTF-8","sec-fetch-mode":"cors"},method:"GET",mode:"cors"}).then((function(e){return e.json()})).then((function(e){return e}))}};var d="serviceWorker"in navigator&&"PushManager"in window;function p(){var e=Object(o.useState)(Notification.permission),n=Object(u.a)(e,2),t=n[0],i=n[1],r=Object(o.useState)(null),c=Object(u.a)(r,2),a=c[0],l=c[1],p=Object(o.useState)(),h=Object(u.a)(p,2),v=h[0],b=h[1],g=Object(o.useState)(null),m=Object(u.a)(g,2),w=m[0],S=m[1],k=Object(o.useState)(!0),y=Object(u.a)(k,2),E=y[0],j=y[1];Object(o.useEffect)((function(){d&&(j(!0),S(!1),navigator.serviceWorker.register("/sw.js").then((function(){j(!1)})))}),[]),Object(o.useEffect)((function(){j(!0),S(!1);!function(){var e;s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(navigator.serviceWorker.ready.then((function(e){return e.pushManager.getSubscription()})).then((function(e){return e})));case 2:e=n.sent,l(e),j(!1);case 5:case"end":return n.stop()}}))}()}),[]);return{onClickAskUserPermission:function(){j(!0),S(!1),s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.awrap(Notification.requestPermission());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}})).then((function(e){i(e),"granted"!==e&&S({name:"Consent denied",message:"You denied the consent to receive notifications",code:0}),j(!1)}))},onClickSusbribeToPushNotification:function(){j(!0),S(!1),function(){var e;return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(navigator.serviceWorker.ready);case 2:return e=n.sent,n.next=5,s.a.awrap(e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:"BIN2Jc5Vmkmy-S3AUrcMlpKxJpLeVRAfu9WBqUbJ70SJOCWGCGXKY-Xzyh7HDr6KbRDGYHjqZ06OcS3BjD7uAm8"}));case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}))}().then((function(e){l(e),j(!1)})).catch((function(e){console.error("Couldn't create the notification subscription",e,"name:",e.name,"message:",e.message,"code:",e.code),S(e),j(!1)}))},onClickSendSubscriptionToPushServer:function(){j(!0),S(!1),f.post("/subscription",a).then((function(e){b(e.id),j(!1)})).catch((function(e){j(!1),S(e)}))},pushServerSubscriptionId:v,onClickSendNotification:function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return j(!0),S(!1),e.next=4,s.a.awrap(f.get("/subscription/".concat(v)).catch((function(e){j(!1),S(e)})));case 4:j(!1);case 5:case"end":return e.stop()}}))},userConsent:t,pushNotificationSupported:d,userSubscription:a,error:w,loading:E}}var h=function(){var e=p(),n=e.userConsent,t=e.pushNotificationSupported,o=(e.userSubscription,e.onClickAskUserPermission),r=e.onClickSusbribeToPushNotification,c=e.onClickSendSubscriptionToPushServer,a=(e.pushServerSubscriptionId,e.onClickSendNotification),s=e.error,u=e.loading;return i.a.createElement("div",null,s&&i.a.createElement("section",{className:"app-error"},i.a.createElement("h2",null,s.name),i.a.createElement("p",null,"Error message : ",s.message),i.a.createElement("p",null,"Error code : ",s.code)),u&&"Loading, please stand by",i.a.createElement("p",null,"Push notification are ",!t&&"NOT"," supported by your device."),i.a.createElement("p",null,"User consent to recevie push notificaitons is ",i.a.createElement("strong",null,n),"."),i.a.createElement("button",{onClick:o},"Ask user permission"),i.a.createElement("button",{onClick:r},"Create Notification subscription"),i.a.createElement("button",{onClick:c},"Send subscription to push server"),i.a.createElement("button",{onClick:a},"Send a notification"))},v=void 0,b=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function g(e,n){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;null!=t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),n&&n.onUpdate&&n.onUpdate(e)):(console.log("Content is cached for offline use."),n&&n.onSuccess&&n.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}function m(e){console.log("[Service Worker] Push Received.");var n=e.data.json(),t=n.image,o=n.tag,i=n.url,r=n.title,c={data:i,body:n.text,icon:t,vibrate:[200,100,200],tag:o,image:t,badge:"https://spyna.it/icons/favicon.ico",actions:[{action:"Detail",title:"View",icon:"https://via.placeholder.com/128/ff0000"}]};e.waitUntil(v.registration.showNotification(r,c))}function w(e){console.log("[Service Worker] Notification click Received.",e.notification.data),e.notification.close(),e.waitUntil(v.clients.openWindow(e.notification.data))}c.a.render(i.a.createElement(h,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/pwatest",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var n="".concat("/pwatest","/service-worker.js");b?(!function(e,n){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(t){var o=t.headers.get("content-type");404===t.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):g(e,n)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(n,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):g(n,e)})),v.addEventListener("push",m),v.addEventListener("notificationclick",w)}}()}],[[5,1,2]]]);
//# sourceMappingURL=main.6b7de4fb.chunk.js.map